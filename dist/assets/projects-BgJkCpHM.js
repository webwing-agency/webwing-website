function T(l){const i=Array.from((l==null?void 0:l.querySelectorAll("img"))||[]);if(!i.length)return Promise.resolve();const o=i.map(f=>f.complete?Promise.resolve():new Promise(u=>{f.addEventListener("load",u,{once:!0}),f.addEventListener("error",u,{once:!0}),setTimeout(u,3e3)}));return Promise.all(o)}async function N(l=document){try{const i=await fetch("/data/projects.json",{cache:"no-store"});if(!i.ok)throw new Error("Failed to load /data/projects.json");const o=await i.json(),f=l.querySelector(".references-page-title");f&&(f.textContent=o.page_title??"");const u=l.querySelector(".selection-flex");if(u&&Array.isArray(o.filters)){u.querySelectorAll(".filter-select").forEach(m=>m.remove());const s=document.createDocumentFragment();o.filters.forEach(m=>{const p=document.createElement("div");p.className="filter-select",p.textContent=m,p.dataset.filter=m.toLowerCase(),s.appendChild(p)});const g=u.querySelector(".search-wrapper");g?u.insertBefore(s,g):u.prepend(s)}const E=l.querySelector(".projects-grid");if(!E)return;E.innerHTML="",o.projects.forEach(s=>{var a,v;const g=document.createElement("div");g.className="project-card grid-card";const m=document.createElement("div");m.className="project-images-grid",s.images.slice(0,3).forEach((t,h)=>{const d=document.createElement("img");d.src=t,d.alt=s.title??"",d.className=`project-image-${h+1}`,m.appendChild(d)});const p=document.createElement("h3");p.className="project-title",p.textContent=s.title??"";const e=document.createElement("ul");e.className="project-specs feature-list",(s.specs||[]).forEach(t=>{const h=typeof t=="string"?{text:t,icon:""}:{text:(t==null?void 0:t.text)||(t==null?void 0:t.label)||"",icon:(t==null?void 0:t.icon)||""},d=document.createElement("li");if(d.className="feature-item",h.icon){const y=document.createElement("i");y.className=`feature-icon ${h.icon}`.trim(),y.setAttribute("aria-hidden","true"),d.appendChild(y)}const x=document.createElement("span");x.className="feature-text",x.textContent=h.text,d.appendChild(x),e.appendChild(d)});const n=document.createElement("p");n.className="project-description",n.textContent=s.description??"";const r=document.createElement("div");r.className="project-card-text-container flex",r.append(e,n);const c=document.createElement("div");if(c.className="card-cta-container flex",(a=s.ctas)!=null&&a.more_link){const t=document.createElement("a");t.href=s.ctas.more_link,t.className="card-cta",t.textContent="Mehr erfahren",c.appendChild(t)}if((v=s.ctas)!=null&&v.contact_link){const t=document.createElement("a");t.href=s.ctas.contact_link,t.className="card-cta",t.textContent="Kontakt",c.appendChild(t)}g.append(m,p,r,c),E.appendChild(g)});const C=l.querySelector(".cta"),L=l.querySelector(".cta-label");if(C&&(C.textContent=o.cta_text??""),L&&(L.textContent=o.cta_label??""),C){const s=o.cta_link||"kostenloses-erstgesprÃ¤ch.html";C.href=s}w(l),await T(E),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.dispatchEvent(new Event("projectsRendered"))})})}catch(i){console.error("renderProjects error:",i)}}function w(l=document){const i=l.querySelector(".search-wrapper"),o=i==null?void 0:i.querySelector(".search-bar"),f=l.querySelector(".selection-flex"),u=Array.from(l.querySelectorAll(".project-card"));if(!i||!o||!f||u.length===0||i.dataset.searchInit==="1")return;i.dataset.searchInit="1";const E=e=>(e||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),C=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),L=(e,n=120)=>{let r;return(...c)=>{clearTimeout(r),r=setTimeout(()=>e(...c),n)}},s=u.map(e=>{const n=e.querySelector(".project-title"),r=e.querySelector(".project-description"),c=e.querySelector(".project-specs");return{card:e,titleEl:n,descEl:r,specsEl:c,originalDisplay:window.getComputedStyle(e).display||"block",titleHTML:(n==null?void 0:n.innerHTML)||"",descHTML:(r==null?void 0:r.innerHTML)||"",specsHTML:(c==null?void 0:c.innerHTML)||"",searchText:E(`${(n==null?void 0:n.textContent)||""} ${(r==null?void 0:r.textContent)||""} ${(c==null?void 0:c.textContent)||""}`)}}),g=e=>{e.titleEl&&(e.titleEl.innerHTML=e.titleHTML),e.descEl&&(e.descEl.innerHTML=e.descHTML),e.specsEl&&(e.specsEl.innerHTML=e.specsHTML)},m=(e,n)=>{if(!e||!n)return;const r=new RegExp(C(n),"gi"),c=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),a=[];for(;c.nextNode();)a.push(c.currentNode);a.forEach(v=>{const t=v.nodeValue;if(!t||!r.test(t))return;r.lastIndex=0;const h=document.createDocumentFragment();let d=0,x;for(;(x=r.exec(t))!==null;){x.index>d&&h.appendChild(document.createTextNode(t.slice(d,x.index)));const y=document.createElement("mark");y.className="search-highlight",y.textContent=x[0],h.appendChild(y),d=x.index+x[0].length}d<t.length&&h.appendChild(document.createTextNode(t.slice(d))),v.parentNode.replaceChild(h,v)})},p=e=>{const n=e.trim(),r=E(n);if(!n){s.forEach(a=>{a.card.style.display=a.originalDisplay,g(a)}),i.style.setProperty("--search-count",'""');return}let c=0;s.forEach(a=>{g(a),a.searchText.includes(r)?(a.card.style.display=a.originalDisplay,m(a.titleEl,n),m(a.descEl,n),m(a.specsEl,n),c++):a.card.style.display="none"}),i.style.setProperty("--search-count",`"${c} von ${s.length} Ergebnissen"`)};o.addEventListener("input",L(e=>p(e.target.value))),f.addEventListener("click",e=>{const n=e.target.closest(".filter-select");if(!n)return;const r=n.textContent.trim().toLowerCase(),c=o.value.trim().toLowerCase();f.querySelectorAll(".filter-select").forEach(a=>a.classList.remove("active")),c===r?o.value="":(o.value=r,n.classList.add("active")),o.dispatchEvent(new Event("input",{bubbles:!0}))}),o.addEventListener("input",()=>{o.value.trim()===""&&f.querySelectorAll(".filter-select.active").forEach(e=>e.classList.remove("active"))}),p("")}async function q(l){await N(l||document)}export{q as initProjectsPage};

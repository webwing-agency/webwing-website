async function w(){const e=await fetch("/data/services.json",{cache:"no-store"});if(!e.ok)throw new Error(`Failed to fetch services.json: ${e.status}`);const t=await e.json();if(!t||!Array.isArray(t.services))throw new Error("Invalid JSON structure: expected { services: [] }");return t}function q(e){if(e.meta_description){let r=document.querySelector('meta[name="description"]');r||(r=document.createElement("meta"),r.name="description",document.head.appendChild(r)),r.content=e.meta_description}e.meta_title&&(document.title=e.meta_title);const t=document.querySelector(".services-page-title")||document.querySelector(".page-title");t&&e.page_title&&(t.textContent=e.page_title)}function S(e){try{return new URL(e,window.location.origin),!0}catch{return!1}}function T(e){return typeof e=="string"?{text:e,icon:""}:e&&typeof e=="object"?{text:String(e.text||e.label||""),icon:String(e.icon||"")}:{text:"",icon:""}}function N(e){const{text:t,icon:r}=T(e),s=document.createElement("li");if(s.className="feature-item",r){const o=document.createElement("i");o.className=`feature-icon ${r}`.trim(),o.setAttribute("aria-hidden","true"),s.appendChild(o)}const a=document.createElement("span");return a.className="feature-text",a.textContent=t,s.appendChild(a),s}function _(e){var h,v;const t=document.createElement("div");t.className="service-card grid-card";const r=document.createElement("div");r.className="service-images-grid",(e.images||[]).forEach(n=>{const c=document.createElement("img");c.src=n,c.alt=e.title||"",c.className="service-image",r.appendChild(c)});const s=document.createElement("h3");s.className="service-title",s.textContent=e.title||"";const a=document.createElement("div");a.className="service-card-text-container flex";const o=document.createElement("p");o.className="service-description",o.textContent=e.description||"";const u=document.createElement("ul");u.className="service-specs feature-list",(e.specs||[]).forEach(n=>{u.appendChild(N(n))}),a.appendChild(o),a.appendChild(u);const p=document.createElement("div");p.className="card-cta-container flex";const m=document.createElement("a");m.className="card-cta",m.textContent="Mehr erfahren",m.href=(h=e.ctas)!=null&&h.more_link&&S(e.ctas.more_link)?e.ctas.more_link:"#";const f=document.createElement("a");return f.className="card-cta",f.textContent="In Kontakt treten",f.href=(v=e.ctas)!=null&&v.contact_link&&S(e.ctas.contact_link)?e.ctas.contact_link:"/kostenloses-erstgespräch.html",p.appendChild(m),p.appendChild(f),t.appendChild(r),t.appendChild(s),t.appendChild(a),t.appendChild(p),t}function k(e,t=document){if(!Array.isArray(e)||e.length===0)return;const r=t.querySelector(".selection-flex"),s=r==null?void 0:r.querySelector(".search-wrapper");!r||!s||(r.querySelectorAll(".filter-select").forEach(a=>a.remove()),e.forEach(a=>{const o=document.createElement("div");o.className="filter-select",o.textContent=a,r.insertBefore(o,s)}))}function b(e){const t=Array.from(e.querySelectorAll("img"));if(t.length===0)return Promise.resolve();const r=t.map(s=>s.complete?Promise.resolve():new Promise(a=>{s.addEventListener("load",a,{once:!0}),s.addEventListener("error",a,{once:!0}),setTimeout(a,3e3)}));return Promise.all(r)}async function A(e=document){try{const t=await w();q(t);const r=e.querySelector(".services-grid");if(!r)return;r.innerHTML="";const s=document.createDocumentFragment();t.services.forEach(u=>{s.appendChild(_(u))}),r.appendChild(s),k(t.filters,e),M(e);const a=e.querySelector(".cta"),o=e.querySelector(".cta-label");a&&t.cta_text&&(a.textContent=t.cta_text),o&&t.cta_label&&(o.textContent=t.cta_label),a&&(a.href=t.cta_link&&S(t.cta_link)?t.cta_link:"kostenloses-erstgespräch.html"),await b(r),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.dispatchEvent(new Event("servicesRendered"))})})}catch(t){console.error("Services render error:",t)}}function M(e=document){const t=e.querySelector(".search-wrapper"),r=t==null?void 0:t.querySelector(".search-bar"),s=e.querySelector(".selection-flex"),a=Array.from(e.querySelectorAll(".service-card"));if(!t||!r||!s||a.length===0||t.dataset.searchInit==="1")return;t.dataset.searchInit="1";const o=n=>(n||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),u=n=>n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),p=(n,c=120)=>{let i;return(...l)=>{clearTimeout(i),i=setTimeout(()=>n(...l),c)}},m=a.map(n=>{const c=n.querySelector(".service-title"),i=n.querySelector(".service-description"),l=n.querySelector(".service-specs");return{card:n,titleEl:c,descEl:i,specsEl:l,originalDisplay:n.style.display||"",titleHTML:(c==null?void 0:c.innerHTML)||"",descHTML:(i==null?void 0:i.innerHTML)||"",specsHTML:(l==null?void 0:l.innerHTML)||"",searchText:o(`${(c==null?void 0:c.textContent)||""} ${(i==null?void 0:i.textContent)||""} ${(l==null?void 0:l.textContent)||""}`)}}),f=n=>{n.titleEl&&(n.titleEl.innerHTML=n.titleHTML),n.descEl&&(n.descEl.innerHTML=n.descHTML),n.specsEl&&(n.specsEl.innerHTML=n.specsHTML)},h=(n,c)=>{if(!n||!c)return;const i=new RegExp(u(c),"gi"),l=document.createTreeWalker(n,NodeFilter.SHOW_TEXT),d=[];for(;l.nextNode();)d.push(l.currentNode);d.forEach(L=>{const x=L.nodeValue;if(!i.test(x))return;i.lastIndex=0;const y=document.createDocumentFragment();let E=0,g;for(;g=i.exec(x);){y.append(x.slice(E,g.index));const C=document.createElement("mark");C.className="search-highlight",C.textContent=g[0],y.append(C),E=g.index+g[0].length}y.append(x.slice(E)),L.replaceWith(y)})},v=n=>{const c=n.trim(),i=o(c);let l=0;m.forEach(d=>{f(d),!c||d.searchText.includes(i)?(d.card.style.display=d.originalDisplay,c&&(h(d.titleEl,c),h(d.descEl,c),h(d.specsEl,c)),l++):d.card.style.display="none"}),t.style.setProperty("--search-count",c?`"${l} von ${m.length} Ergebnissen"`:'""')};r.addEventListener("input",p(n=>v(n.target.value))),s.addEventListener("click",n=>{const c=n.target.closest(".filter-select");if(!c)return;const i=c.textContent.trim().toLowerCase();s.querySelectorAll(".filter-select").forEach(l=>l.classList.remove("active")),r.value.trim().toLowerCase()===i?r.value="":(r.value=i,c.classList.add("active")),r.dispatchEvent(new Event("input",{bubbles:!0}))}),r.addEventListener("input",()=>{r.value===""&&s.querySelectorAll(".filter-select").forEach(n=>n.classList.remove("active"))}),v("")}async function H(e){await A(e||document)}export{H as initServicesPage};
